{% extends 'main/base.html' %}
{% load staticfiles %}
{% load bleach_tags %}
{% load humanize %}
{% load utils %}

{% block container %}
  <div class="row row-offcanvas row-offcanvas-right">
    <div class="col-xs-12 col-sm-9">
      <p class="pull-right visible-xs">
        <button type="button" class="btn btn-primary btn-xs" data-toggle="offcanvas">Toggle nav</button>
      </p>
      <!--
      <div class="jumbotron">
        <h4 class="base-popular-topic-title">
          Recent topics
        </h4>
        <div class = "row base-popular-topic-row">
          <div class = "col-md-9 base-popular-topic-name">
            Topic title
          </div>
          <div class = "col-md-3 base-popular-topic-user">
            User started
          </div>
        </div>
      </div>
      -->
      <div class="row" id="pinned_post">
        {% for pinned_topic in pinned_topics %}
          <div class="col-xs-10">
            {% if pinned_topic.forum__forum_group__group_type == 'f' %}
              <a href="{% url 'forum:topic_retrieve' pinned_topic.forum pinned_topic.id %}">
            {% else %}
              <a href="{% url 'library:topic_retrieve' pinned_topic.forum pinned_topic.id %}">
            {% endif %}
              <h2>{{ pinned_topic.title }}</h2>
            </a>
            <p class = "pinned-post-author">
              By <a href="{% url 'user:profile' pinned_topic.created_by %}">{{ pinned_topic.created_by__username }}</a>,
              {{ pinned_topic.created_at|naturaltime }}
            </p>
            <div class="pinned-post-content-container col-xs-12">
              <p class= "pinned-post-content">
                {{ pinned_topic.content|bleach }}
              </p>
            </div>
            <div>
              <div class = "row">
                <div class = "col-xs-9">
                  {% if pinned_topic.forum__forum_group__group_type == 'f' %}
                    <a class="btn btn-default" href="{% url 'forum:topic_retrieve' pinned_topic.forum pinned_topic.id %}" role="button">
                  {% else %}
                    <a class="btn btn-default" href="{% url 'library:topic_retrieve' pinned_topic.forum pinned_topic.id %}" role="button">
                  {% endif %}
                    See more &raquo;
                  </a>
                </div>
                <div class="home-post-vote-wrapper button-container">
                  <a class="btn btn-default home-post-downvote"
                     href="javascript:void(0)"
                     post-id="{{ pinned_topic.post__id }}"
                     role="button"
                     id="downvote-{{ pinned_topic.post__id }}">
                    <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                  </a>
                  <div class="col-xs-1 home-post-count-upvote" id="total-vote-{{ pinned_topic.post__id }}" role="button">
                    {{ pinned_topic.post__num_upvotes|subtract:pinned_topic.post__num_downvotes }}
                  </div>
                  <a class="btn btn-default home-post-upvote"
                     href="javascript:void(0)"
                     post-id="{{ pinned_topic.post__id }}"
                     role="button"
                     id="upvote-{{ pinned_topic.post__id }}">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
{#        <nav>#}
{#          <ul class="pagination pinned-post-pagination">#}
{#            <li>#}
{#              <a href="#" aria-label="Previous">#}
{#                <span aria-hidden="true">&laquo;</span>#}
{#              </a>#}
{#            </li>#}
{#            <li><a href="#">1</a></li>#}
{#            <li><a href="#">2</a></li>#}
{#            <li><a href="#">3</a></li>#}
{#            <li><a href="#">4</a></li>#}
{#            <li><a href="#">5</a></li>#}
{#            <li>#}
{#              <a href="#" aria-label="Next">#}
{#                <span aria-hidden="true">&raquo;</span>#}
{#              </a>#}
{#            </li>#}
{#          </ul>#}
{#        </nav>#}
      </div><!--/row-->
    </div><!--/.col-xs-12.col-sm-9-->
    <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar">
      <div id="contest_schedule">
        <ul>
          <li><a href="#contest-schedule-content">Các kỳ thi sắp tới</a></li>
        </ul>
        <div id="contest-schedule-content">
          <table class="table">
            <thead>
              <tr>
                <th>Kỳ thi</th>
                <th>Thời gian</th>
              </tr>
            </thead>
            <tbody>
              {% for contest in coming_contests %}
                <tr>
                  <td>
                    <a href="{{ contest.url }}">{{ contest.contest_name }}</a>
                    <p class="text-left">{{ contest.start_time|naturaltime }}</p>
                  </td>
                  <td>
                    <p class="">{{ contest.duration }}'</p>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div id="top-rank-panel">
        <ul>
          <li><a href="#top-voj">VOJ</a></li>
          <li><a href="#top-contribution">Đóng góp</a></li>
        </ul>
        <div id="top-voj">
          <table class="table">
            <thead>
              <tr>
                <th>#</th>
                <th>Thành viên</th>
                <th>Điểm</th>
              <tr>
            </thead>
            <tbody id="user-rank-table">
            </tbody>
          </table>
          <div class="panel-footer"> <a href="http://ngthanhtrung23.github.io/VOJRanklist/"><small>Full Table</small></a> </div>
        </div>
        <div id="top-contribution">
          <table class="table">
            <thead>
              <tr>
                <th>#</th>
                <th>Username</th>
                <th>Score</th>
              <tr>
            </thead>
            <tbody>
              {% for contributor in contributors %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ contributor.user__username }}</td>
                  <td>{{ contributor.contribution }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
          <div class="panel-footer"> <a href=""><small>Full Table</small></a> </div>
        </div>
      </div>

      <div id="recent_post">
        <ul>
          <li><a href="#recent_post_content">Bài viết mới</a></li>
        </ul>
        <div>
          <table class="table">
            <thead>
              <tr>
                <th>Chủ đề</th>
                <th>Bởi</th>
              </tr>
            </thead>
            <tbody>
              {% for post in recent_posts %}
                {% if post.topic__id %}
                  <tr>
                    <td>
                      <a href="{% url 'forum:topic_retrieve' post.topic__forum__id post.topic__id %}" class="base-popular-topic-link">
                        {{ post.topic__title }}
                      </a>
                    </td>
                    <td>
                      {{ post.created_by__username }}
                    </td>
                  </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

    </div><!--/.sidebar-offcanvas-->
  </div><!--/row-->
{% endblock container %}

{% block extra-js %}
  <script src="http://ngthanhtrung23.github.io/VOJRanklist/js/data.js"></script>
  <script src="{% static 'js/home.js' %}"></script>
  {% include 'forum/disable_voted.html' with votes=votes %}
{% endblock %}